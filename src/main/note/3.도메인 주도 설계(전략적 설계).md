3.도메인 주도 설계(전략적 설계)
=========================
### ◉ 마이크로서비스 설계 시 고려사항 
- 마이크로서비스를 어떤 기준으로 분리할 것인가?
- 서비스 간의 어떻게 연계할 것인가?
- 어떤 이벤트에 의해 마이크로서비스는 서로 반응하는가?
- 마이크로서비스 내부는 어떻게 설게할 것인가?

## ⭕ 도메인 주도 설계란?
도메인 주도 설계는 복잡한 비즈니스 요구사항을 객체지향 모델로 구조화하고 도메인의 핵심 개념과 로직을 명확히 표현하여 소프트웨어 품질과 유연성을 높이는 설계 방법론이다.  
어떻게 구조화할 것인가(How)에 초점을 맞추며 도메인을 바운디드 컨텍스트로 나누고 내부에 어그리거트 구조를 설계하는 방식이다. (2장 참고)

- 비즈니스 도메인 이란: 기업의 주요 활동 영역, 회사가 제공하는 서비스
- Sub domain (하위 도메인): 비즈니스 활동의 세분화된 영역, 제공하는 서비스 단위

### ◉ 하위 도메인 유형
- 핵심(Core)
  - 비즈니스의 핵심 가치를 제공하는 도메인 (차별화된 경쟁력을 갖출수 있는 도메인, 예: 구글 검색 알고리즘)
  - 자주 지속적으로 변경이 예상되므로, 가장 많은 리소스 및 고도화, 신기술 적용
- 일반(Generic)
  - 비즈니스에 필수적이지만 차별화되지 않는 도메인 (예: 결제 시스템, 사용자 인증)
  - 일반적으로 안정적이고 표준화된 기술을 사용하여 구현, 오픈 소스 솔루션
- 지원(Supporting)
  - 비즈니스 운영을 지원하는 도메인 (예: CRUD, ETL)

### ◉ 멘탈모델과 도메인 지식
도메인 지식이란 도메인 전문가가 문제를 생각하는 방식, 즉 멘탈 모델이다.
기존 과정에서는 도메인 지식을 분석, 설계, 구현 단계로 변환하는 과정을 거쳤으나 도메인 주도 설계에서는 도메인 지식을 변환하는 대신 도메인을 설명하기 위한 단일화된 체계를 사용한다. 이를 유비쿼터스 언어라고 한다.

#### ❓유비쿼터스 언어란?
개발자와 비즈니스 전문가(도메인 전문가)가 소통할 때 사용하는 공통의 언어. 코드, 설계 문서, 대화 등 모든 곳에서 일관되게 사용하는 용어 체계이다.
정확하고 일관성 있는 용어를 사용하고 모호한 용어나 동의어는 사용하지 않는다. 

##### ✦ 특징
- 모두가 이해 가능: 개발자, 기획자, 도메인 전문가가 같은 단어를 같은 의미로 씀. 
- 일관성: 코드, 대화, 문서, 테스트 이름 등 모든 곳에서 동일한 용어 사용. 
- 도메인 모델 기반: 비즈니스 개념을 정확하게 표현.

##### ✦ 예시
- 기획서에는 장바구니라고 적었는데 디자이너는 카트라고 디자인함, 개발자는 DB 테이블 이름을 Basket으로 지음, API 명세는 /api/cart라고 작성
- 장바구니(Basket)라는 용어로 합의, 기획서: 장바구니, 디자인 시안: 장바구니, DB 테이블: Basket, 클래스명: Basket, BasketItem, API: /api/basket

### ◉ 도메인 모델
도메인 모델은 도메인 지식을 표현하는 추상화된 모델로 도메인의 핵심 개념과 그들 간의 관계를 정의한다.
유비쿼터스 언어로 사실상 비즈니스 모데인 모델을 구축하는 것을 도메인 모델링이라고 한다.

#### ✦ 진흙 덩어리(Big Ball of Mud)
도메인 모델링이 제대로 이루어지지 않으면 진흙 덩어리라고 불리는 복잡하고 비효율적인 코드 구조가 발생할 수 있다.
이는 코드가 명확한 구조 없이 얽혀 있어 유지보수와 확장이 어려운 상태를 의미하며 용어가 충돌할 수 있고 의미가 모호해진다.

### ◉ 바운디드 컨텍스트(Bounded Context)
도메인의 경계를 정의하여 해당 도메인 내에서 일관된 모델과 언어를 사용하는 영역을 의미한다. (2장 참고)
- 명확한 경계를 정의
- 내부 모델이 외부에 노출되지 않음
- 유비쿼터스 언어가 일관되게 적용
- 각 바운디드 컨텍스트의 생명주기는 독립적

#### ✦ 바운디드 컨텍스트와 하위 도메인의 차이점
- 하위도메인은 비지니스 전략에 의해 정의됨, 반면에 바운디드 컨텍스트는 소프트웨어 엔지니어에 의해 설계됨
- 하위 도메인은 발견되고 바운디드 컨텍스트는 설계됨
️
#### ❓도메인 주도 설계는 그럼 기획, 디자인, 프론트, 백엔드, DB 모두 도메인 주도 설계를 따라야 하는가?
반드시 그런 것은 아니다. 모두가 유비쿼터스 언어를 공유하는 것이 핵심, 기술적인 DDD 패턴은 주로 도메인 모델을 다루는 백엔드에서 깊이 사용한다.
하지만 DB 테이블 구조는 맞추는 것이 좋으며 불가피할 경우 명시적인 매핑 계층을 둬서 코드에는 유비쿼터스 언어를 유지하는 것이 좋다.

```java
@Entity
@Table(name = "cart")
class Basket { ... }
```

#### ✦ 도메인 주도 설계 시 용어 충돌 문제
각 컨텍스트 영역에서 동일한 용어로 인해 충돌이 발생할 수 있다. 이를 해결하기 위해 컨텍스트 맵을 사용하여 각 바운디드 컨텍스트 간의 관계를 정의하고 용어 충돌을 해결한다.

##### 예시
- 주문, 배송, 고객 등의 도메인에서 고객이란 용어가 사용되지만 주문에서는 주문 고객, 배송에서는 배송 고객, 고객 관리에서는 일반 고객 등으로 구분될 수 있다.

##### ✦ 컨텍스트 맵
컨텍스트 맵은 바운디드 컨텍스트 간의 관계를 시각적으로 표현한 것으로 각 컨텍스트의 경계와 상호작용을 정의한다.

### ◉ 컨텍스트 매핑
컨텍스트 매핑은 바운디드 컨텍스트 간의 관계를 정의하고 상호작용을 명확히 하는 과정이다. 이를 통해 각 컨텍스트의 경계를 이해하고 용어 충돌을 해결할 수 있다.
바운디드 컨텍스트는 서로 독립적으로 발전할 수 있지만 상호작용이 필요한 경우가 많다. 이때 컨텍스트 매핑을 통해 각 컨텍스트 간의 관계를 정의한다.

#### ✦ 협력형 패턴
소통이 잘되는 컨텍스트 간의 관계를 정의하는 패턴이다. 협력형 패턴은 두 컨텍스트가 서로 협력하여 상호작용하는 경우에 사용된다.
- 파트너십 패턴
  - 두 컨텍스트가 서로 협력하여 상호작용하는 경우
  - 연동의 조정은 양방향, 서로의 변경 사항을 반영
- 공유 영역 패턴
  - 두 컨텍스트가 일부 데이터를 공유하는 경우, 교집합이 존재
  - 공유 영역은 두 컨텍스트 간의 데이터 일관성을 유지하기 위해 사용되고 서로의 생명주기에도 영향을 미친다.

#### ✦ 공급자, 소비자 패턴
컨텍스트 간의 데이터 흐름을 정의하는 패턴이다. 공급자와 소비자 간의 관계를 정의하며 데이터의 흐름 방향에 따라 업스트림과 다운스트림으로 구분된다.
- 순응주의자 패턴
  - 힘이 업스트림에 있음
  - 다운 스트림 컨텍스트가 업스트림 컨텍스트의 변경 사항에 적극적으로 반응
- 충돌 방지 계층 패턴(ACL: Anti-Corruption Layer)
  - 힘이 업스트림에 존재하여 다운스트림에서 필요에 맞게 가공하는 패턴
  - 다운 스트림 바운디드 컨텍스트가 핵심 하위 도메인을 포함하거나, 업스트림 요건이 비효율적이거나 불편한 경우, 제공자가 컨트랙트를 자주 변경하는 경우 사용
  - 업스트림 컨텍스트의 변경 사항이 다운스트림 컨텍스트에 영향을 미치지 않도록 ACL을 두어 변환 계층을 제공
- 오픈 호스트 서비스 패턴(OHS: Open-Host Service)
  - 힘이 다운스트림에 있음
  - 업스트림 컨텍스트가 OHS를 제공하여 다운스트림 컨텍스트에 맞춰 데이터를 쉽게 소비할 수 있도록 처리
  - 공표된 언어(PL: Published Language)를 사용하여 다운스트림 컨텍스트가 업스트림 컨텍스트의 데이터를 이해할 수 있도록 함

#### ✦ 분리형 노선
커뮤니케이션이 어렵거나 불가능한 컨텍스트 간의 관계를 정의하는 패턴이다. 이 패턴은 두 컨텍스트가 서로 독립적으로 존재하며 중복을 허용하여 각 컨텍스트가 독립적으로 발전할 수 있도록 한다.

### ◉ 퀴즈
1. 마이크로서비스 설계에 도메인 주도 전략적 설계를 사용하는 주요 이유는 무엇일까요? 
   1. 기술 스택 표준화 및 통일 
   2. 데이터베이스 모델 통합 및 단순화
   3. 개발자 생산성만을 극대화 
   4. 비즈니스 기능의 응집도 향상 및 서비스 간 결합도 최소화

2. 비즈니스의 차별화된 경쟁 우위를 제공하며 높은 복잡성을 가지는 하위 도메인 유형은 무엇인가요?
   1. 일반 하위 도메인
   2. 지원 하위 도메인
   3. 핵심 하위 도메인
   4. 공통 하위 도메인

3. 도메인 주도 설계에서 '유비쿼터스 언어'와 '도메인 모델'이 바운디드 컨텍스트 내에서 가지는 핵심적인 역할은 무엇일까요?
   1. 데이터베이스 테이블 설계 표준화
   2. 기술적인 구현 방식 결정
   3. 비즈니스 개념을 일관되고 명확하게 표현하고 시스템에 반영
   4. 서비스 간 동기적 통신 방식 강제

4. 서로 다른 유비쿼터스 언어와 도메인 모델을 사용하는 '바운디드 컨텍스트'들 간의 관계와 상호작용 방식을 정의하는 도메인 주도 설계의 개념은 무엇인가요?
   1. 전술적 설계
   2. 하위 도메인 분류
   3. 컨텍스트 매핑
   4. 도메인 이벤트

5. 컨텍스트 매핑 패턴 중, 다운스트림(Downstream) 시스템이 업스트림(Upstream) 시스템의 모델에 영향을 받지 않도록 중간에서 모델을 변환하고 보호하는 역할을 하는 패턴은 무엇일까요?
   1. 공유 커널 (Shared Kernel)
   2. 오픈 호스트 서비스 (Open Host Service)
   3. 안티-커럽션 레이어 (Anti-Corruption Layer)
   4. 분리된 길 (Separate Ways)
